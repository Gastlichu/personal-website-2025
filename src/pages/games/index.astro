---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import Layout from '../../layouts/Layout.astro';
import Badge from '../../components/ui/Badge.astro';
import Button from '../../components/ui/Button.astro';

// Get all games, sorted by date (newest first)
const games = (await getCollection('games'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Separate featured and regular
const featured = games.filter(g => g.data.featured);
const regular = games.filter(g => !g.data.featured);

function getStatusColor(status: string) {
  switch (status) {
    case 'Released': return 'warm';
    case 'In Development': return 'default';
    case 'Prototype': return 'outline';
    case 'Jam Entry': return 'outline';
    default: return 'default';
  }
}
---

<Layout
  title="Games | Cosmic Ocean"
  description="Interactive experiences and game projects — explorations of play, atmosphere, and digital spaces."
  room="games"
>
  <div class="min-h-screen px-6 py-24">
    <div class="max-w-5xl mx-auto">
      <!-- Room Title -->
      <header class="mb-16 text-center">
        <h1 class="text-4xl md:text-5xl font-display font-light text-text-primary mb-4">
          <span class="glow-game">Games</span>
        </h1>
        <p class="text-text-secondary font-body">
          Interactive experiences from the cosmic deep
        </p>
      </header>

      <!-- Featured Games -->
      {featured.length > 0 && (
        <section class="mb-16">
          <h2 class="text-h3 text-text-secondary mb-6">Featured</h2>
          <div class="space-y-8">
            {featured.map((game) => (
              <a href={`/games/${game.slug}`} class="block group">
                <article class="game-card relative rounded-lg bg-surface/50 border border-aurora/30 overflow-hidden transition-all duration-300 hover:border-aurora/60 hover:shadow-[0_0_30px_rgba(176,112,208,0.2)]">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
                    <!-- Image -->
                    <div class="aspect-video bg-gradient-to-br from-abyss/50 to-nebula/30 rounded-lg flex items-center justify-center overflow-hidden">
                      {game.data.image ? (
                        <Image
                          src={game.data.image}
                          alt={game.data.title}
                          width={600}
                          height={338}
                          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                          loading="lazy"
                        />
                      ) : (
                        <span class="text-6xl text-aurora/40 font-display font-light select-none group-hover:scale-110 transition-transform">◈</span>
                      )}
                    </div>

                    <!-- Info -->
                    <div class="flex flex-col justify-center">
                      <div class="flex flex-wrap gap-2 mb-3">
                        <Badge variant={getStatusColor(game.data.status)}>{game.data.status}</Badge>
                        {game.data.platform.map((p) => (
                          <Badge variant="outline">{p}</Badge>
                        ))}
                      </div>
                      <h3 class="font-display text-2xl text-text-primary group-hover:text-aurora transition-colors mb-2">
                        {game.data.title}
                      </h3>
                      <p class="text-text-secondary font-body leading-relaxed mb-4">
                        {game.data.description}
                      </p>
                      <p class="text-sm text-text-muted">
                        {game.data.date.getFullYear()}
                      </p>
                    </div>
                  </div>
                </article>
              </a>
            ))}
          </div>
        </section>
      )}

      <!-- All Games -->
      <section>
        {featured.length > 0 && regular.length > 0 && (
          <h2 class="text-h3 text-text-secondary mb-6">All Projects</h2>
        )}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 content-auto">
          {regular.map((game) => (
            <a href={`/games/${game.slug}`} class="block group">
              <article class="game-card relative rounded-lg bg-surface/50 border border-aurora/20 overflow-hidden transition-all duration-300 hover:border-aurora/50 p-5">
                <div class="flex flex-wrap gap-2 mb-3">
                  <Badge variant={getStatusColor(game.data.status)}>{game.data.status}</Badge>
                </div>
                <h3 class="font-display text-lg text-text-primary group-hover:text-aurora transition-colors mb-2">
                  {game.data.title}
                </h3>
                <p class="text-sm text-text-secondary font-body leading-relaxed mb-3 line-clamp-2">
                  {game.data.description}
                </p>
                <p class="text-sm text-text-muted">
                  {game.data.date.getFullYear()} · {game.data.platform.join(', ') || 'TBD'}
                </p>
              </article>
            </a>
          ))}
        </div>
      </section>

      {games.length === 0 && (
        <p class="text-center text-text-muted">
          Games are loading from the void...
        </p>
      )}
    </div>
  </div>
</Layout>

<style>
  .glow-game {
    text-shadow:
      0 0 20px var(--color-aurora),
      0 0 40px var(--color-bloom);
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
